<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>REPL Jack-in and Connection Sequences - Calva Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "REPL Jack-in and Connection Sequences";
    var mkdocs_page_input_path = "connect-sequences.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Calva Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../connect/">Connect Calva to Your Project</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../try-first/">Something to Try First (After Connecting)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../finding-commands/">Finding Calva Commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../eval-tips/">Code Evaluation Tips</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Features</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../commands-top10/">The Top 10 Calva Commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../formatting/">Formatting</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../paredit/">Paredit – a Visual Guide</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../debugger/">Debugger</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pprint/">Pretty Printing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../linting/">Linting</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Customizing Calva</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../customizing/">Customizing Calva</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">REPL Jack-in and Connection Sequences</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#settings-for-adding-custom-sequences">Settings for adding Custom Sequences</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-sequences">Example Sequences</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../custom-commands/">Running Custom REPL Commands</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using Calva with X</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../rebl/">How to Use Calva and REBL Together</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../vim/">Calva and the VIM Extension</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../wsl/">Calva ❤️ WSL</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../remote-development/">Using Calva with Remote Development</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../luminus/">How to Use Calva with Luminus</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Etcetera</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../workspace-layouts/">Workspace layouts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../quirks/">Quirks</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">In Depth</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../jack-in-guide/">Learn about Calva Jack-in</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Calva Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Customizing Calva &raquo;</li>
        
      
    
    <li>REPL Jack-in and Connection Sequences</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="repl-jack-in-and-connection-sequences">REPL Jack-in and Connection Sequences</h1>
<p>Many projects grow out of the template phase and call for custom developer workflows involving application start commands, customized REPLs, and what have you. Even some templates add this kind of complexity. To make Jack-in usable for a broader set of projects, Calva has a setting keyed <code>calva.replConnectSequences</code> which lets you configure one ore more connect sequences.</p>
<p>NB: <em>Connect sequence configuration affect Calva's Jack-in menu in the following ways:</em></p>
<ol>
<li>With <em>no sequence</em> configured, Calva will prompt for the built in sequences it has that seems to match your project.</li>
<li>With <em>only one</em> custom connect sequence specified, Calva will skip prompting for sequences and use your custom sequence.</li>
<li>With <em>more than one</em>  sequence specified, Calva will prompt with a menu consisting of these custom sequences.</li>
</ol>
<h2 id="settings-for-adding-custom-sequences">Settings for adding Custom Sequences</h2>
<p>A connect sequence configures the following:</p>
<ul>
<li><code>name</code>: (required) This will show up in the Jack-in quick-pick menu when you start Jack-in (see above).</li>
<li><code>projectType</code>: (required) This is either "Leiningen”, ”Clojure-CLI”, ”shadow-cljs”, ”lein-shadow”, or ”generic".</li>
<li><code>nReplPortFile</code>: An array of path segments with the project root-relative path to the nREPL port file for this connect sequence. E.g. For shadow-cljs this would be <code>[".shadow-cljs", "nrepl.port"]</code>.</li>
<li><code>afterCLJReplJackInCode</code>: Here you can give Calva some Clojure code to evaluate in the CLJ REPL, once it has been created.</li>
<li><code>cljsType</code>: This can be either "Figwheel Main", "lein-figwheel", "shadow-cljs", "Nashorn", or a dictionary configuring a custom type. If omitted, Calva will skip connecting a ClojureScript repl. A custom type has the following fields:<ul>
<li><code>dependsOn</code>: (required) Calva will use this to determine which dependencies it will add when starting the project (Jacking in). This can be either "Figwheel Main", "lein-figwheel", "shadow-cljs", "Nashorn", or ”User provided”. If it is "User provided", then you need to provide the dependencies in the project, or launch with an alias (deps.edn), profile (Leiningen), or build (shadow-cljs) that provides the dependencies needed.</li>
<li><code>isStarted</code>: Boolean. For CLJS REPLs that Calva does not need to start, set this to true. (If you base your custom cljs repl on a shadow-cljs workflow, for instance.)</li>
<li><code>startCode</code>: Clojure code to be evaluated to create and/or start your custom CLJS REPL.</li>
<li><code>isStartedRegExp</code>: A regular expression which, when matched in the stdout from the startCode evaluation, will make Calva continue with connecting the REPL, and to prompt the user to start the application. If omitted and there is startCode Calva will continue when that code is evaluated.</li>
<li><code>openUrlRegExp</code>: A regular expression, matched against the stdout of cljsType evaluations, for extracting the URL with which the app can be started. The expression should have a capturing group named <code>url</code>. E.g. "Open URL: (?\&lt;url>S+)"</li>
<li><code>shouldOpenUrl</code>: Choose if Calva should automatically open the URL for you or not.</li>
<li><code>connectCode</code>: (required) Clojure code to be evaluated to convert the REPL to a CLJS REPL that Calva can use to connect to the application. (For some setups this could also conditionally start the CLJS REPL. If so: <code>startCode</code> should be omitted.)</li>
<li><code>isConnectedRegExp</code>: (required) A regular expression which, when matched in the <code>stdout</code> from the <code>connectCode</code> evaluation, will tell Calva that the application is connected. The default is <code>To quit, type: :cljs/quit</code> and you should leave it at that unless you know it won't work.</li>
<li><code>printThisLineRegExp</code>: regular expression which, when matched in the <code>stdout</code> from any code evaluations in the <code>cljsType</code>, will make the matched text be printed to the <strong>Calva says</strong> Output channel.</li>
<li><code>buildsRequired</code>: Boolean. If the repl type requires that builds are started in order to connect to them, set this to true.</li>
</ul>
</li>
<li><code>menuSelections</code>: a dictionary with pre-filled-in selections for the Jack-in and Connect prompts, making Calva not prompt for that particular selection:<ul>
<li><code>leinProfiles</code>: At Jack-in to a Leiningen project, use these profiles to launch the repl.</li>
<li><code>leinAlias</code>: At Jack-in to a Leiningen project, launch with this alias. Set to <code>null</code> to launch with Calva's default task (a headless repl), w/o prompting.</li>
<li><code>cljAliases</code>: At Jack-in to a Clojure CLI project, use these aliases to launch the repl.</li>
<li><code>cljsLaunchBuilds</code>: The cljs builds to start/watch at Jack-in/connect.</li>
<li><code>cljsDefaultBuild</code>: Which cljs build to attach to at the initial connect.</li>
</ul>
</li>
</ul>
<p>The <a href="https://github.com/BetterThanTomorrow/calva/blob/master/src/nrepl/connectSequence.ts">Calva built-in sequences</a> also uses this format, check them out to get a clearer picture of how these settings work.</p>
<h2 id="example-sequences">Example Sequences</h2>
<p>Setting for a full-stack application. It starts the backend server when the CLJ REPL has started. Then proceeds to create a custom CLJS REPL (calling in to the application code for this). And then connects to it.</p>
<pre><code class="json">{
    &quot;calva.replConnectSequences&quot;: [
        {
            &quot;name&quot;: &quot;Example Sequence&quot;,
            &quot;projectType&quot;: &quot;Clojure-CLI&quot;,
            &quot;afterCLJReplJackInCode&quot;: &quot;(go)&quot;,
            &quot;cljsType&quot;: {
                &quot;startCode&quot;: &quot;(do (require '[cljs-test.main :refer :all])(start-nrepl+fig))&quot;,
                &quot;isStartedRegExp&quot;: &quot;Prompt will show&quot;,
                &quot;connectCode&quot;: &quot;(do (use 'cljs-test.main) (cljs-repl))&quot;,
                &quot;isConnectedRegExp&quot;: &quot;To quit, type: :cljs/quit&quot;,
                &quot;printThisLineRegExp&quot;: &quot;\\[Figwheel\\] Starting Server at.*&quot;
            }
        }
    ]
}
</code></pre>

<p>Here is an example from the <a href="https://juxt.pro/blog/posts/edge.html">JUXT Edge</a> project template. It adds two sequences, one for when only the Clojure REPL should be launched and one for when the customized Edge cljs repl should also be connected. The <strong>Edge backend + frontend</strong> sequence specifies that the web app should be opened by Calva, making cljs repl connection more stable, and also adds <code>menuSelections</code> to skip the <strong>launch aliases</strong> prompt.</p>
<pre><code class="json">{
    &quot;calva.replConnectSequences&quot;: [
        {
            &quot;name&quot;: &quot;Edge backend only&quot;,
            &quot;projectType&quot;: &quot;Clojure CLI&quot;
        },
        {
            &quot;name&quot;: &quot;Edge backend + frontend&quot;,
            &quot;projectType&quot;: &quot;Clojure CLI&quot;,
            &quot;cljsType&quot;: {
                &quot;dependsOn&quot;: &quot;Figwheel Main&quot;,
                &quot;startCode&quot;: &quot;(do (require 'dev-extras) (dev-extras/go) (println \&quot;Edge Figwheel Main started\&quot;) ((resolve 'dev-extras/cljs-repl)))&quot;,
                &quot;isReadyToStartRegExp&quot;: &quot;Edge Figwheel Main started&quot;,
                &quot;openUrlRegExp&quot;: &quot;Website listening on: (?&lt;url&gt;\\S+)&quot;,
                &quot;printThisLineRegExp&quot;: &quot;\\[Edge\\]&quot;,
                &quot;shouldOpenUrl&quot;: true,
                &quot;connectCode&quot;: &quot;(do (require 'dev-extras) ((resolve 'dev-extras/cljs-repl)))&quot;,
                &quot;isConnectedRegExp&quot;: &quot;To quit, type: :cljs/quit&quot;,
                &quot;buildsRequired&quot;: false
            },
            &quot;menuSelections&quot;: {
                &quot;cljAliases&quot;: [
                    &quot;dev&quot;,
                    &quot;build&quot;,
                    &quot;dev/build&quot;
                ],
            }
        }
    ]
}
</code></pre>

<p>A Clojure CLI sequence that does not promote the ClojureScript repl at all (leaving it a Clojure REPL), and leaves that up to you to do interactively. (Could be useful while you are developing a custom cljs repl.) The example is for when adapting a Figwheel Main repl.</p>
<pre><code class="json">{
    &quot;calva.replConnectSequences&quot;: [
        {
            &quot;name&quot;: &quot;Do not promote to cljs&quot;,
            &quot;projectType&quot;: &quot;Clojure CLI&quot;,
            &quot;cljsType&quot;: {
                &quot;dependsOn&quot;: &quot;Figwheel Main&quot;,
                &quot;connectCode&quot;: &quot;\&quot;Don't promote me bro!\&quot;&quot;,
                &quot;isConnectedRegExp&quot;: &quot;Don't promote me bro!&quot;
            }
        }
    ]
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../custom-commands/" class="btn btn-neutral float-right" title="Running Custom REPL Commands">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../customizing/" class="btn btn-neutral" title="Customizing Calva"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../customizing/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../custom-commands/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
